<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Testovací prostředí pdf_tool</title>
  <!-- Odkaz na externí CSS soubor -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Testovací prostředí pro pdf_tool</h1>

<div class="container">
  <label for="functionSelect">Vyber funkci:</label>
  <select id="functionSelect">
    <option value="ocr">OCR (vytvoření .txt)</option>
    <option value="blend">Blend (sloučení PDF)</option>
  </select>

  <div id="dropZone">Přetáhněte .pdf / .png / .jpg sem</div>
  
  <!-- Skryté pole pro případy, kdy uživatel klikne na dropZone -->
  <input 
    type="file" 
    id="fileInput" 
    multiple 
    accept=".pdf,.png,.jpg,.jpeg" 
    style="display: none;" 
  />

  <!-- Seznam vybraných souborů -->
  <div id="fileList"></div>

  <button id="sendBtn">Odeslat</button>
  
  <div id="status"></div>
  <div id="downloadLink"></div>
</div>

<script>
  const dropZone       = document.getElementById('dropZone');
  const fileInput      = document.getElementById('fileInput');
  const sendBtn        = document.getElementById('sendBtn');
  const statusDiv      = document.getElementById('status');
  const downloadDiv    = document.getElementById('downloadLink');
  const functionSelect = document.getElementById('functionSelect');
  const fileListDiv    = document.getElementById('fileList');

  // =====================================================
  // Funkce, která zobrazí seznam vybraných souborů v divu #fileList
  // =====================================================
  function updateFileList() {
    fileListDiv.innerHTML = ''; // Vymažeme stávající obsah
    
    const files = fileInput.files;
    if (!files || files.length === 0) {
      fileListDiv.innerHTML = '<p style="color:#999;">Žádné soubory vybrány</p>';
      return;
    }
    
    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      
      // Vytvoříme box pro jeden soubor
      const fileBox = document.createElement('div');
      fileBox.classList.add('file-item');
      fileBox.innerHTML = `
        <strong>${file.name}</strong><br>
        Typ: ${file.type || 'neznámý'}<br>
        Velikost: ${(file.size / 1024).toFixed(2)} KB
      `;
      
      fileListDiv.appendChild(fileBox);
    }
  }

  // =====================================================
  // Drag & Drop
  // =====================================================
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    e.stopPropagation();
    dropZone.classList.add('hover');
  });

  dropZone.addEventListener('dragleave', (e) => {
    e.preventDefault();
    e.stopPropagation();
    dropZone.classList.remove('hover');
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    e.stopPropagation();
    dropZone.classList.remove('hover');

    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
      // Přeneseme soubory do fileInput
      fileInput.files = e.dataTransfer.files;
      // Aktualizujeme seznam souborů
      updateFileList();
    }
  });

  // Kliknutí na dropZone => otevření dialogu pro ruční výběr souborů
  dropZone.addEventListener('click', () => {
    fileInput.click();
  });

  // Změna v inputu (když uživatel vybere soubory přes dialog)
  fileInput.addEventListener('change', () => {
    updateFileList();
  });

  // =====================================================
  // Klik na tlačítko "Odeslat"
  // =====================================================
  sendBtn.addEventListener('click', () => {
    statusDiv.textContent = 'Odesílám...';
    downloadDiv.innerHTML = '';

    const selectedFunction = functionSelect.value;
    const files = fileInput.files;

    if (!files || files.length === 0) {
      alert('Nebyl vybrán žádný soubor!');
      statusDiv.textContent = '';
      return;
    }

    // Připravíme FormData
    const formData = new FormData();
    formData.append('function', selectedFunction);

    for (let i = 0; i < files.length; i++) {
      formData.append('files[]', files[i]);
    }

    // AJAX - odeslání na upload.php
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'upload.php', true);

    xhr.onload = () => {
      if (xhr.status === 200) {
        try {
          const response = JSON.parse(xhr.responseText);
          if (response.success) {
            statusDiv.textContent = 'Hotovo! Výstup připraven.';
            // Nabídneme odkaz ke stažení
            downloadDiv.innerHTML = 
              '<a href="' + response.downloadUrl + '" target="_blank">Stáhnout výsledek</a>';
          } else {
            statusDiv.textContent = 'Chyba: ' + (response.error || 'Neznámá chyba');
          }
        } catch (e) {
          statusDiv.textContent = 'Chyba při parsování odpovědi od serveru.';
        }
      } else {
        statusDiv.textContent = 'Chyba: ' + xhr.statusText;
      }
    };

    xhr.onerror = () => {
      statusDiv.textContent = 'Chyba připojení nebo selhání požadavku.';
    };

    xhr.send(formData);
  });

  // Načteme prázdný seznam souborů na startu
  updateFileList();
</script>

</body>
</html>
